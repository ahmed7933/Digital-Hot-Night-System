<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hot Night ğŸ”¥ | Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js"></script>

    <style>
        /* === 1. ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ === */
        #login-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #050505; z-index: 10000;
            display: flex; justify-content: center; align-items: center;
            background-image: radial-gradient(circle at 50% 50%, #1a0505 0%, #000 90%);
        }
        .login-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(212, 175, 55, 0.3);
            padding: 40px 30px; border-radius: 25px;
            width: 90%; max-width: 350px; text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
        }
        .login-input {
            width: 100%; background: rgba(0,0,0,0.5); border: 1px solid #333;
            padding: 15px; border-radius: 12px; color: #fff;
            margin-bottom: 15px; font-family: 'Cairo'; font-size: 1rem;
            text-align: center; transition: 0.3s;
        }
        .login-input:focus { border-color: #d4af37; outline: none; box-shadow: 0 0 10px rgba(212, 175, 55, 0.2); }
        .login-msg { margin-top: 15px; font-size: 0.9rem; min-height: 20px; }
        .msg-error { color: #ff4d4d; }
        .msg-success { color: #2ecc71; }

        /* === 2. ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© === */
        :root { --primary: #d4af37; --accent: #e50914; --blue: #00bfff; --purple: #8a2be2; --pink: #ff00cc; --green: #2ecc71; --bg: #050505; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; outline: none; }
        body { margin: 0; background-color: var(--bg); background-image: radial-gradient(circle at 50% 50%, #150505 0%, #000 90%); font-family: 'Cairo', sans-serif; color: white; height: 100vh; height: 100dvh; overflow: hidden; display: flex; justify-content: center; align-items: center; }
        .screen { display: none; width: 100%; height: 100%; max-height: 100dvh; position: relative; z-index: 2; flex-direction: column; align-items: center; padding: 15px; overflow-y: auto; -webkit-overflow-scrolling: touch; opacity: 0; transition: opacity 0.3s ease-in; }
        .screen.active { display: flex; opacity: 1; }
        .btn-gold { background: linear-gradient(90deg, #b8860b, #ffd700, #b8860b); background-size: 200%; color: black; font-weight: bold; padding: 12px; width: 100%; border-radius: 50px; border: none; font-size: 1rem; cursor: pointer; animation: shine 4s infinite linear; box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4); }
        .btn-gold:disabled { opacity: 0.6; cursor: not-allowed; }
        
        /* Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø³ØªØ§ÙŠÙ„Ø§Øª (Ù…Ø®ØªØµØ±Ø© Ù„Ø¹Ø¯Ù… Ø§Ù„Ø¥Ø·Ø§Ù„Ø© ÙˆÙ„ÙƒÙ†Ù‡Ø§ Ø¶Ø±ÙˆØ±ÙŠØ©) */
        .top-nav { width: 100%; max-width: 500px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 0 5px; height: 40px; flex-shrink: 0; }
        .nav-title { font-size: 1.1rem; font-weight: 800; color: var(--primary); margin: 0; text-align: center; flex-grow: 1; }
        .exit-btn { background: rgba(255,255,255,0.1); border: 1px solid #444; color: #aaa; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1rem; cursor: pointer; }
        .dummy-space { width: 35px; }
        .dashboard-header { width: 100%; max-width: 500px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-shrink: 0; }
        .guide-btn { background: rgba(255,255,255,0.1); border: 1px solid var(--primary); color: var(--primary); padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; cursor: pointer; }
        .games-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; width: 100%; max-width: 500px; padding-bottom: 20px; }
        .game-item { position: relative; aspect-ratio: 1 / 1; border-radius: 18px; overflow: hidden; cursor: pointer; border: 1px solid #333; }
        .game-item.full-width { grid-column: span 2; aspect-ratio: auto; height: 100px; }
        .game-item img { width: 100%; height: 100%; object-fit: cover; opacity: 0.8; }
        .game-label { position: absolute; bottom: 0; left: 0; width: 100%; padding: 10px; background: linear-gradient(to top, black, rgba(0,0,0,0.5)); text-align: center; }
        .g-title { font-size: 1rem; font-weight: 800; color: white; margin-bottom: 2px;} .g-sub { font-size: 0.7rem; color: var(--primary); font-weight: bold; }
        
        /* Modal & Popups */
        .modal-glass { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 100; display: none; justify-content: center; align-items: center; flex-direction: column; padding: 20px; backdrop-filter: blur(5px); }
        .modal-glass.show { display: flex; animation: fadeIn 0.3s; }
        .guide-content, .instr-content, .rp-box { background: #151515; border: 1px solid var(--primary); border-radius: 20px; padding: 25px; text-align: right; width: 100%; max-width: 400px; }
        .rp-box { max-width: 350px; border-color: var(--accent); }
        
        /* Card Flip */
        .card-stage { perspective: 1000px; width: 100%; max-width: 320px; height: 320px; margin: 20px auto; display: flex; align-items: center; justify-content: center; }
        .flipper { position: relative; width: 100%; height: 100%; transform-style: preserve-3d; transition: 0.6s; }
        .front, .back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 20px; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; text-align: center; border: 2px solid var(--primary); box-shadow: 0 15px 40px rgba(0,0,0,0.6); background: #151515; }
        .front { background: #111 url('https://www.transparenttextures.com/patterns/carbon-fibre.png'); }
        .back { transform: rotateY(180deg); }
        .flipped { transform: rotateY(180deg); }
        .text-content { font-size: 1.35rem; font-weight: bold; color: #fff; }

        /* Elimination Game */
        .elimination-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; width: 100%; max-width: 340px; margin: 15px auto; padding: 0 5px; }
        .place-card { aspect-ratio: 1 / 1; border-radius: 12px; background: #222; border: 1px solid var(--primary); display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; transition: 0.2s; padding: 5px; }
        .place-card.eliminated { opacity: 0.3; filter: grayscale(100%); }
        .place-card.winner { transform: scale(1.05); box-shadow: 0 0 15px var(--primary); background: var(--primary); }
        .place-card.winner .place-name { color: black; }
        .place-name { font-size: 0.75rem; font-weight: bold; text-align: center; }
        .place-icon { font-size: 1.8rem; }
        .turn-banner { background: rgba(255,255,255,0.1); border: 1px solid var(--primary); padding: 10px; border-radius: 10px; margin-bottom: 10px; text-align: center; font-weight: bold; }

        /* Catch Me Game */
        .board-container { width: 100%; background-image: radial-gradient(#222 1px, transparent 1px); background-size: 15px 15px; margin-bottom: 5px; border-radius: 15px; border: 1px solid #333; padding: 5px; display: flex; flex-direction: column-reverse; align-items: center; gap: 3px; }
        .row { display: flex; gap: 3px; justify-content: center; width: 100%; }
        .square { width: 38px; height: 38px; border-radius: 6px; display: flex; justify-content: center; align-items: center; font-weight: bold; font-size: 0.8rem; position: relative; border: 1px solid rgba(255,255,255,0.1); }
        .blue-zone { background: linear-gradient(135deg, #00bfff, #0077be); }
        .purple-zone { background: linear-gradient(135deg, #8a2be2, #4b0082); }
        .pink-zone { background: linear-gradient(135deg, #ff00cc, #99007a); }
        .red-zone { background: linear-gradient(135deg, #ff0055, #990033); }
        .finish-zone { background: linear-gradient(135deg, var(--primary), #b8860b); color: black; }
        .player-token { width: 14px; height: 14px; border-radius: 50%; position: absolute; border: 1px solid white; z-index: 5; }
        .p1-token { background: var(--primary); top: 1px; left: 1px; }
        .p2-token { background: white; bottom: 1px; right: 1px; }
        .catch-controls { padding: 5px; background: #1a1a1a; border-top: 2px solid var(--blue); width: 100%; display: flex; justify-content: space-around; align-items: center; border-radius: 15px; }
        .dice-btn { width: 50px; height: 50px; background: white; color: black; border-radius: 10px; font-size: 1.5rem; font-weight: 900; border: none; cursor: pointer; }
        .dice-btn.rolling { animation: shake 0.5s infinite; }
        .catch-card { background: #151515; width: 90%; max-width: 350px; border-radius: 20px; padding: 25px; text-align: center; border: 2px solid var(--primary); }

        /* Wheel Game */
        .wheel-container { width: 330px; height: 330px; position: relative; border-radius: 50%; border: 8px solid #222; overflow: hidden; margin: 0 auto; }
        .wheel-bg, .wheel-icons-layer { width: 100%; height: 100%; border-radius: 50%; position: absolute; top:0; left:0; transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99); }
        .icon-box { position: absolute; top: 50%; left: 50%; width: 0; height: 0; }
        .icon-content { position: absolute; left: -20px; bottom: 65px; width: 40px; text-align: center; font-size: 1.8rem; color: white; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5)); }
        .pointer { position: absolute; top: -20px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent; border-top: 45px solid #fff; z-index: 20; }
        .wheel-result-card { background: #111; border: 3px solid var(--green); padding: 25px; border-radius: 25px; text-align: center; width: 90%; max-width: 380px; }

        /* Scratch */
        .reset-btn { background: rgba(255, 255, 255, 0.05); border: 1px solid #555; color: #888; padding: 8px 20px; border-radius: 50px; margin-top: 15px; font-size: 0.85rem; cursor: pointer; display: block; margin-left: auto; margin-right: auto; }
        
        @keyframes shake { 0% { transform: rotate(0deg); } 25% { transform: rotate(10deg); } 75% { transform: rotate(-10deg); } 100% { transform: rotate(0deg); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-card">
            <div style="font-size:3rem; margin-bottom:10px;">ğŸ”¥</div>
            <h2 style="color:var(--primary); margin-bottom:5px;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
            <p style="color:#888; font-size:0.8rem; margin-bottom:30px;">Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ù‡Ø±Ø© Ø§Ù„Ø¢Ù…Ù†</p>
            
            <input type="text" id="login-username" class="login-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
            <input type="tel" id="login-password" class="login-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (4 Ø£Ø±Ù‚Ø§Ù…)" maxlength="4">
            
            <button class="btn-gold" id="login-btn">Ø¯Ø®ÙˆÙ„</button>
            <div id="login-msg" class="login-msg"></div>
        </div>
    </div>

    <div id="welcome-overlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#050505; z-index:9999; display:none; justify-content:center; align-items:center; flex-direction:column; transition: opacity 0.5s;">
        <div class="logo" style="margin-bottom:20px; font-size:3rem;">ğŸ”¥</div>
        <h1 style="color:var(--primary); margin-bottom:10px; font-size: 2rem;">HOT NIGHT</h1>
        <p style="color:#888; margin-bottom:30px; font-family:'Cairo';">Ø§Ø¶ØºØ· Ù„Ù„Ø¨Ø¯Ø¡ ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª ğŸ”Š</p>
        <button class="btn-gold" style="width:200px;" onclick="initApp()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø³Ù‡Ø±Ø© ğŸš€</button>
    </div>

    <div id="modal-guide" class="modal-glass">
        <div class="guide-content">
            <h2 style="color:white; text-align:center; margin-top:0;">ğŸŒ™ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©</h2>
            <div class="step-box"><div class="step-head"><span>1. Ø¶Ø­Ùƒ ÙˆØ¯Ù„Ø¹ ğŸ˜‚</span></div><div class="step-desc">Ù†Ø¨Ø¯Ø£ Ø¨Ù‡Ø²Ø§Ø± ÙˆÙØ±ÙØ´Ø©.</div></div>
            <div class="step-box"><div class="step-head"><span>2. Ø­Ø¨ ÙˆÙ‚Ø±Ø¨ â¤ï¸</span></div><div class="step-desc">Ù†Ø´ØºÙ„ Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø´ÙˆÙŠØ©.</div></div>
            <div class="step-box" style="border-color: #ff9800;"><div class="step-head"><span style="color:#ff9800">3. Ø£Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø±ÙƒØ© âš”ï¸</span></div><div class="step-desc">Ù†ØªÙÙ‚ (Ø¨Ø§Ù„ØªØ±Ø§Ø¶ÙŠ) Ù‡Ù†Ø¹Ù…Ù„ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© ÙÙŠÙ†.</div></div>
            <div class="step-box"><div class="step-head"><span>4. Ù‡Ù…Ø³ ÙˆÙ„Ù…Ø³ ğŸ”¥</span></div><div class="step-desc">Ù†Ø±ÙˆØ­ Ø§Ù„Ù…ÙƒØ§Ù† ÙˆÙ†Ø¨Ø¯Ø£ ØªØ³Ø®ÙŠÙ†.</div></div>
            <div class="step-box"><div class="step-head"><span style="color:var(--accent)">5. Ù†Ø§Ø± ÙˆØ¯Ù…Ø§Ø± ğŸ”</span></div><div class="step-desc">Ø§Ù„Ù„Ù‚Ø§Ø¡ Ø§Ù„ÙƒØ§Ù…Ù„ ÙˆØ§Ù„Ø£ÙƒØ´Ù†.</div></div>
            <button class="btn-gold" onclick="closeGuide()">ÙÙ‡Ù…Øª.. ÙŠÙ„Ø§ Ø¨ÙŠÙ†Ø§ ğŸš€</button>
        </div>
    </div>

    <div id="instructions-screen" class="modal-glass">
        <div class="instr-content">
            <div id="instr-title" class="instr-title">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù„Ø¹Ø¨Ø©</div>
            <div id="instr-body" class="instr-body"></div>
            <button class="btn-gold" id="instr-start-btn">ÙŠÙ„Ø§ Ù†Ø¨Ø¯Ø£ ğŸš€</button>
            <button style="background:none; border:none; color:#888; margin-top:15px; width:100%; cursor:pointer;" onclick="document.getElementById('instructions-screen').classList.remove('show')">Ø±Ø¬ÙˆØ¹</button>
        </div>
    </div>

    <div id="wheel-modal" class="modal-glass">
        <div class="wheel-result-card">
            <div id="wheel-result-icon" style="font-size:4rem; margin-bottom:5px;"></div>
            <h2 id="wheel-result-title" style="color:var(--green); margin:0; font-weight:900; font-size:1.6rem;"></h2>
            <p id="wheel-result-desc"></p>
            <button class="btn-gold" style="background:linear-gradient(90deg, var(--green), #27ae60); border:none;" onclick="closeWheelModal()">Ù†ÙØ°Ù†Ø§ Ø§Ù„Ø£Ù…Ø± ğŸ˜‰</button>
        </div>
    </div>

    <div id="catch-modal" class="modal-glass">
        <div class="catch-card" id="catch-card-content"></div>
    </div>

    <div id="confirm-modal" class="modal-glass">
        <div class="instr-content" style="text-align:center; max-width:300px;">
            <div class="instr-title" style="color:var(--accent); border:none; margin-bottom:5px;">âš ï¸ ØªÙ†Ø¨ÙŠÙ‡</div>
            <p style="color:#ddd; margin-bottom:25px; font-size:1rem;">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ<br>Ù‡ÙŠØªÙ… Ù…Ø³Ø­ Ø§Ù„ØªÙ‚Ø¯Ù… ÙˆØ§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ù†Ù‚Ø·Ø© Ø§Ù„ØµÙØ±!</p>
            <div style="display:flex; gap:10px; justify-content:center;">
                <button class="btn-gold" style="background:var(--accent); color:white; width:100px;" onclick="executeReset()">Ù†Ø¹Ù…</button>
                <button class="btn-gold" style="background:#333; color:#ccc; width:100px;" onclick="closeConfirmModal()">Ù„Ø§</button>
            </div>
        </div>
    </div>

    <div id="dashboard" class="screen">
        <div class="dashboard-header">
            <div>
                <h2 style="color:white; margin:0;">Ø¨Ø§ÙƒØ¯Ø¬ Ø§Ù„Ø³Ù‡Ø±Ø© Ø§Ù„Ø²ÙˆØ¬ÙŠØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø© ğŸ”¥</h2>
                <p style="color:var(--primary); font-size:0.8rem; margin:5px 0 0 0;">9 ØªØ¬Ø§Ø±Ø¨ Ù…Ø®ØªÙ„ÙØ© Ù„Ù„ÙŠÙ„Ø© Ù…Ø«Ø§Ù„ÙŠØ©</p>
            </div>
            <button class="guide-btn" onclick="openGuide()">Ø§Ù„Ø¯Ù„ÙŠÙ„ ğŸ—ºï¸</button>
        </div>
        
        <div class="games-grid">
            <div class="game-item" onclick="openInstructions('game1')">
                <img src="images/cover1.webp" onerror="this.src='images/cover1.png'" alt="Fun">
                <div class="game-label"><div class="g-title">1. Ø¶Ø­Ùƒ ÙˆØ¯Ù„Ø¹ ğŸ˜‚</div><div class="g-sub">Ù‡Ø²Ø§Ø± ÙˆØ°ÙƒØ±ÙŠØ§Øª</div></div>
            </div>
            <div class="game-item" onclick="openInstructions('game2')">
                <img src="images/cover2.webp" onerror="this.src='images/cover2.png'" alt="Love">
                <div class="game-label"><div class="g-title">2. Ø­Ø¨ ÙˆÙ‚Ø±Ø¨ â¤ï¸</div><div class="g-sub">Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠØ© ÙˆÙ…Ø´Ø§Ø¹Ø±</div></div>
            </div>
            <div class="game-item" onclick="openInstructions('game3')" style="border-color: #ff9800;">
                <img src="images/cover3.webp" onerror="this.src='images/cover3.png'" alt="Places">
                <div class="game-label"><div class="g-title" style="color:#ff9800">3. Ø£Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø±ÙƒØ© âš”ï¸</div><div class="g-sub">ØªØ­Ø¯ÙŠØ¯ Ù…ÙƒØ§Ù† Ø§Ù„Ø³Ù‡Ø±Ø©</div></div>
            </div>
            <div class="game-item" onclick="openInstructions('game4')">
                <img src="images/cover4.webp" onerror="this.src='images/cover4.png'" alt="Touch">
                <div class="game-label"><div class="g-title">4. Ù‡Ù…Ø³ ÙˆÙ„Ù…Ø³ ğŸ”¥</div><div class="g-sub">Ø¥Ø«Ø§Ø±Ø© Ø­Ø³ÙŠØ©</div></div>
            </div>
            <div class="game-item" onclick="openInstructions('game5')" style="border-color: var(--accent);">
                <img src="images/cover5.webp" onerror="this.src='images/cover5.png'" alt="Hot">
                <div class="game-label"><div class="g-title" style="color:var(--accent)">5. Ù†Ø§Ø± ÙˆØ¯Ù…Ø§Ø± ğŸ”</div><div class="g-sub">ØªØ­Ø¯ÙŠØ§Øª Ø¬Ø±ÙŠØ¦Ø©</div></div>
            </div>
            <div class="game-item" onclick="openInstructions('game6')">
                <img src="images/cover6.webp" onerror="this.src='images/cover6.png'" alt="Roleplay">
                <div class="game-label"><div class="g-title">6. ØªÙ…Ø«ÙŠÙ„ Ø³Ø§Ø®Ù† ğŸ­</div><div class="g-sub">Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª</div></div>
            </div>
            <div class="game-item" onclick="openInstructions('game7')" style="border-color: var(--blue);">
                <img src="images/cover7.webp" onerror="this.src='images/cover7.png'" alt="Catch Me">
                <div class="game-label"><div class="g-title" style="color:var(--blue)">7. Ø±Ø­Ù„Ø© Ø§Ù„Ù…ØªØ¹Ø© ğŸ²</div><div class="g-sub">Ø§Ù„Ø³Ù„Ù… ÙˆØ§Ù„Ø«Ø¹Ø¨Ø§Ù†</div></div>
            </div>
            <div class="game-item" onclick="openInstructions('game8')" style="border-color: var(--green);">
                <img src="images/cover8.webp" onerror="this.src='images/cover8.png'" alt="Spin">
                <div class="game-label"><div class="g-title" style="color:var(--green)">8. Ø¹Ø¬Ù„Ø© Ø§Ù„Ø£ÙˆØ¶Ø§Ø¹ ğŸ¡</div><div class="g-sub">Ù„Ù ÙˆÙ†ÙØ°</div></div>
            </div>
            <div class="game-item full-width" onclick="openInstructions('game9')">
                <img src="images/cover9.webp" onerror="this.src='images/cover9.jpeg'" alt="Gift">
                <div class="game-label"><div class="g-title">9. Ø®Ø±Ø¨Ø´ Ù‡Ø¯ÙŠØªÙƒ ğŸ</div><div class="g-sub">Ø¬Ø§Ø¦Ø²Ø© Ø§Ù„Ø®ØªØ§Ù…</div></div>
            </div>
        </div>
    </div>

    <div id="gameplay" class="screen">
        <div class="top-nav">
            <button class="exit-btn" onclick="goHome()">âœ•</button>
            <h2 id="g-header" class="nav-title"></h2>
            <div class="dummy-space"></div>
        </div>
        <div class="card-stage">
            <div class="flipper" id="card-obj">
                <div class="front"><div style="font-size:4rem; color:var(--primary);">?</div><p style="color:#666;">Ø§Ø¶ØºØ· Ù„Ù„ÙƒØ´Ù</p></div>
                <div class="back"><div id="q-text" class="text-content"></div></div>
            </div>
        </div>
        <button class="btn-gold" style="width:200px; margin-top:30px;" onclick="flip()">Ø§Ø³Ø­Ø¨ ÙƒØ§Ø±Øª</button>
    </div>

    <div id="elimination-area" class="screen">
        <div class="top-nav">
            <button class="exit-btn" onclick="goHome()">âœ•</button>
            <h2 class="nav-title" style="color:#ff9800;">Ø£Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø±ÙƒØ© âš”ï¸</h2>
            <div class="dummy-space"></div>
        </div>
        <div class="turn-banner" id="elim-turn">Ø§Ù„Ø¯ÙˆØ± Ø¹Ù„Ù‰: Ø§Ù„Ø²ÙˆØ¬ ğŸ‘¨ (Ø§Ø­Ø°Ù Ù…ÙƒØ§Ù†)</div>
        <div class="elimination-grid" id="places-grid"></div>
        <button class="btn-gold" id="reset-elim-btn" style="display:none; margin-top:20px;" onclick="resetElimination()">Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø© ğŸ”„</button>
    </div>

    <div id="scratch-area" class="screen" style="justify-content: center;">
        <div class="top-nav" style="margin-bottom: 30px;">
            <button class="exit-btn" onclick="goHome()">âœ•</button>
            <h2 class="nav-title" style="color:var(--primary);">Ø®Ø±Ø¨Ø´ Ù‡Ø¯ÙŠØªÙƒ ğŸ</h2>
            <div class="dummy-space"></div>
        </div>
        <div style="position:relative; width:300px; height:150px; border:2px dashed var(--primary); border-radius:15px; overflow:hidden; background: #fff;">
            <div id="prize-txt" style="position:absolute; width:100%; height:100%; display:flex; justify-content:center; align-items:center; background:white; color:black; font-size:1.4rem; font-weight:bold; padding: 10px; text-align: center;"></div>
            <canvas id="cvs" style="position:absolute; top:0; left:0;"></canvas>
        </div>
        <button class="btn-gold" style="width:200px; margin-top:20px;" onclick="resetScratch()">Ø¬Ø§ÙŠØ²Ø© ØªØ§Ù†ÙŠØ©</button>
    </div>

    <div id="roleplay-area" class="screen">
        <div class="top-nav">
            <button class="exit-btn" onclick="goHome()">âœ•</button>
            <h2 class="nav-title" style="color:var(--accent);">ğŸ­ ØªÙ…Ø«ÙŠÙ„ Ø³Ø§Ø®Ù†</h2>
            <div class="dummy-space"></div>
        </div>
        <p style="color:#aaa; font-size:0.9rem; margin-bottom:20px; text-align:center;">Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø¬Ø§Ù‡Ø² Ù„Ù„ÙŠÙ„Ø© Ù…Ø®ØªÙ„ÙØ©</p>
        <div class="rp-box">
            <div class="rp-label">Ø§Ù„Ø´Ø®ØµÙŠØ§Øª:</div><div id="rp-chars" class="rp-val"></div>
            <div class="rp-label">Ø§Ù„Ù…Ù„Ø§Ø¨Ø³ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:</div><div id="rp-wear" class="rp-val"></div>
            <div class="rp-label">Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù‚ØµØ©:</div><div id="rp-plot" class="rp-val" style="border:none; font-size:1rem; line-height:1.5;"></div>
        </div>
        <button class="btn-gold" style="width:200px; margin-top:20px; background: linear-gradient(90deg, #e50914, #ff5050);" onclick="genRoleplay()">Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø¬Ø¯ÙŠØ¯ ğŸ¬</button>
    </div>

    <div id="catch-game-area" class="screen">
        <div class="top-nav">
            <button class="exit-btn" onclick="goHome()">âœ•</button>
            <h2 class="nav-title" style="color:var(--blue);">Ø±Ø­Ù„Ø© Ø§Ù„Ù…ØªØ¹Ø© ğŸ²</h2>
            <div class="dummy-space"></div>
        </div>
        
        <div class="board-container" id="board"></div>
        
        <div class="catch-controls">
            <div style="text-align:center;">
                <div style="font-size:0.7rem; color:#aaa;">Ø§Ù„Ø¯ÙˆØ± Ø¹Ù„Ù‰</div>
                <div id="catch-player" style="font-weight:bold; color:var(--primary);">Ø§Ù„Ø²ÙˆØ¬ ğŸ‘¨</div>
            </div>
            <button class="dice-btn" id="catch-dice" onclick="rollCatchDice()" ontouchstart="rollCatchDice()">ğŸ²</button>
            <div style="text-align:center;">
                <div style="font-size:0.7rem; color:#aaa;">Ø§Ù„Ù…ÙƒØ§Ù†</div>
                <div id="catch-pos" style="font-weight:bold;">Start</div>
            </div>
        </div>
        <button class="reset-btn" onclick="openConfirmModal()">ğŸ”„ Ø§Ø¨Ø¯Ø£ Ù…Ù† Ø¬Ø¯ÙŠØ¯</button>
    </div>

    <div id="spin-game-area" class="screen">
        <div class="top-nav">
            <button class="exit-btn" onclick="goHome()">âœ•</button>
            <h2 class="nav-title" style="color:var(--green);">Ø¹Ø¬Ù„Ø© Ø§Ù„Ø£ÙˆØ¶Ø§Ø¹ ğŸ¡</h2>
            <div class="dummy-space"></div>
        </div>
        <div class="spin-header">
            <span style="color:#aaa; font-weight:bold;">Ø§Ù„Ø¯ÙˆØ± Ø¹Ù„Ù‰:</span>
            <span id="spin-player" style="color:var(--green); font-weight:900;">Ø§Ù„Ø²ÙˆØ¬ ğŸ‘¨</span>
        </div>
        <div style="position:relative; margin-top: 20px;">
            <div class="pointer"></div>
            <div class="wheel-container">
                <div class="wheel-bg" id="wheel-bg"></div>
                <div class="wheel-icons-layer" id="wheel-icons"></div>
            </div>
        </div>
        <button class="btn-gold" style="width:200px; margin-top:40px; background: linear-gradient(90deg, #2ecc71, #27ae60);" onclick="spinWheel()">Ù„Ù Ø§Ù„Ø¹Ø¬Ù„Ø© ğŸ’«</button>
    </div>

    <script>
        // 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ (Login System)
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzb2DSj-DkCWXpOIEYx5K9YXjmTyEnKqisinT1WChncWIeEA9At8GVU95cNSO75pf7x/exec";

        // 2. ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø±Ø§Ø± Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        window.onload = function() {
            // Ø±Ø¨Ø· Ø²Ø±Ø§Ø± Ø§Ù„Ø¯Ø®ÙˆÙ„
            const loginBtn = document.getElementById('login-btn');
            if(loginBtn) loginBtn.addEventListener('click', performLogin);

            // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ ØªÙ‚Ø¯Ù… Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸ (Ø¥Ù† ÙˆØ¬Ø¯)
            const savedP1 = localStorage.getItem('hn_catch_p1');
            const savedP2 = localStorage.getItem('hn_catch_p2');
            const savedTurn = localStorage.getItem('hn_catch_turn');
            if(savedP1) catchPlayers[0].pos = parseInt(savedP1);
            if(savedP2) catchPlayers[1].pos = parseInt(savedP2);
            if(savedTurn) cTurn = parseInt(savedTurn);
        };

        // 3. Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Ø§Ù„Ø£Ù…Ù† ÙˆØ§Ù„Ø­Ù…Ø§ÙŠØ©)
        async function getDeviceFingerprint() {
            try {
                const fp = await FingerprintJS.load();
                const result = await fp.get();
                return result.visitorId;
            } catch (error) {
                return "unknown_" + Math.random();
            }
        }

        async function performLogin() {
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value.trim();
            const msgBox = document.getElementById('login-msg');
            const btn = document.getElementById('login-btn');

            msgBox.className = "login-msg"; msgBox.innerText = "";

            if(!username || !password) {
                msgBox.innerText = "Ø§ÙƒØªØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙŠØ§ ÙÙ†Ø§Ù† ğŸ˜‰";
                msgBox.classList.add("msg-error");
                return;
            }

            btn.disabled = true;
            btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...";
            msgBox.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±...";

            try {
                const deviceId = await getDeviceFingerprint();
                const url = `${GOOGLE_SCRIPT_URL}?action=login&username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}&deviceId=${deviceId}`;
                
                const response = await fetch(url);
                const data = await response.json(); 

                if (data.success === true) {
                    msgBox.innerText = data.message || "ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­ âœ…";
                    msgBox.classList.add("msg-success");
                    
                    setTimeout(() => {
                        document.getElementById('login-overlay').style.display = 'none';
                        const welcome = document.getElementById('welcome-overlay');
                        if(welcome) welcome.style.display = 'flex';
                    }, 1000);
                } else {
                    throw new Error(data.message);
                }

            } catch (err) {
                btn.disabled = false;
                btn.innerText = "Ø¯Ø®ÙˆÙ„";
                msgBox.innerText = err.message || "Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø© Ø£Ùˆ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ âŒ";
                msgBox.classList.add("msg-error");
            }
        }

        // 4. Ù…Ø­Ø±Ùƒ Ø§Ù„Ù„Ø¹Ø¨Ø© (Ø§Ù„ØµÙˆØª ÙˆØ§Ù„Ù„ÙˆØ¬ÙŠÙƒ)
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            if (type === 'click') {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain); gain.connect(audioCtx.destination);
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(300, audioCtx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                osc.start(); osc.stop(audioCtx.currentTime + 0.1);
            } 
            else if (type === 'win') {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain); gain.connect(audioCtx.destination);
                osc.type = 'sine';
                osc.frequency.setValueAtTime(500, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.5);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 1);
                osc.start(); osc.stop(audioCtx.currentTime + 1);
            }
            else if (type === 'dice') {
                for(let i=0; i<6; i++) {
                    setTimeout(() => {
                        const osc = audioCtx.createOscillator();
                        const gain = audioCtx.createGain();
                        osc.connect(gain); gain.connect(audioCtx.destination);
                        osc.type = 'square';
                        osc.frequency.setValueAtTime(200 + Math.random()*200, audioCtx.currentTime);
                        gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
                        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.05);
                        osc.start(); osc.stop(audioCtx.currentTime + 0.05);
                    }, i * 80); 
                }
            }
            else if (type === 'tick') {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain); gain.connect(audioCtx.destination);
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(800, audioCtx.currentTime);
                gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.03);
                osc.start(); osc.stop(audioCtx.currentTime + 0.03);
            }
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // =======================
        // 5. Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (DB)
        // =======================
        const db = {
            stage1: [
                { t: "b", q: "Ù…ÙŠÙ† ÙÙŠÙ†Ø§ Ø¨ÙŠØµØ±Ù ÙÙ„ÙˆØ³ Ø£ÙƒØªØ± Ø¹Ù„Ù‰ Ø­Ø§Ø¬Ø§Øª ØªØ§ÙÙ‡Ø©ØŸ" },
                { t: "b", q: "Ù…ÙŠÙ† ÙÙŠÙ†Ø§ Ø¨ÙŠØ´Ø®Ø± ÙˆÙ‡Ùˆ Ù†Ø§ÙŠÙ…ØŸ" },
                { t: "b", q: "Ù…ÙŠÙ† ÙÙŠÙ†Ø§ Ø¨ÙŠØ¹Ø±Ù ÙŠØ­ÙˆØ´ ÙÙ„ÙˆØ³ØŸ" },
                // ... (Ø§Ø®ØªØµØ§Ø±Ø§Ù‹ Ù„Ù„ÙƒÙˆØ¯ØŒ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø³ØªØ¹Ù…Ù„ Ø¨Ù†ÙØ³ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø¥Ø°Ø§ Ø£Ø¶ÙØªÙ‡Ø§ Ù‡Ù†Ø§)
                { t: "m", q: "Ù‚Ù„Ø¯ ØµÙˆØª Ø­Ù…Ø§ØªÙƒ ÙˆÙ‡ÙŠ Ø¨ØªØ´ØªÙƒÙŠ." },
                { t: "f", q: "Ù‚Ù„Ø¯ÙŠ Ø·Ø±ÙŠÙ‚Ø© Ø¬ÙˆØ²Ùƒ Ù„Ù…Ø§ ÙŠØ±Ø¬Ø¹ Ù…Ù† Ø§Ù„Ø´ØºÙ„ ØªØ¹Ø¨Ø§Ù†." }
            ],
            stage2: [
                { t: "b", q: "ÙØ§ÙƒØ± Ø£ÙˆÙ„ Ù…Ø±Ø© Ø¹ÙŠÙ†ÙŠ Ø¬Øª ÙÙŠ Ø¹ÙŠÙ†ÙƒØŸ ÙƒØ§Ù† Ø¥Ø­Ø³Ø§Ø³Ùƒ Ø¥ÙŠÙ‡ØŸ" },
                { t: "m", q: "Ø¥ÙŠÙ‡ Ø£ÙƒØªØ± Ø­Ø§Ø¬Ø© Ø¨ØªØ­Ø¨Ù‡Ø§ ÙÙŠ Ø´Ø®ØµÙŠØ© Ù…Ø±Ø§ØªÙƒØŸ" }
            ],
            stage3: [
                { t: "m", q: "Ø¨ÙˆØ³Ø© Ø·ÙˆÙŠÙ„Ø© ÙˆØ¹Ù…ÙŠÙ‚Ø© Ø¹Ù„Ù‰ Ø±Ù‚Ø¨Ø© Ù…Ø±Ø§ØªÙƒ." },
                { t: "f", q: "Ø¨ÙˆØ³ÙŠ Ø±Ù‚Ø¨Ø© Ø¬ÙˆØ²Ùƒ Ø¨Ø¨Ø·Ø¡ Ø´Ø¯ÙŠØ¯." }
            ],
            stage4: [
                { t: "b", q: "ÙˆØ¶Ø¹ 'Ø§Ù„Ø¯ÙˆØ¬ÙŠ' (Doggy): Ø§Ù„Ø²ÙˆØ¬Ø© ØªØ³Ù†Ø¯ Ø¹Ù„Ù‰ Ø±ÙƒØ¨Ù‡Ø§ ÙˆØ¥ÙŠØ¯ÙŠÙ‡Ø§ (ÙˆØ¶Ø¹ Ø§Ù„Ø³Ø¬ÙˆØ¯)ØŒ ÙˆØ§Ù„Ø²ÙˆØ¬ ÙŠØ£ØªÙŠ Ù…Ù† Ø§Ù„Ø®Ù„Ù." },
                { t: "b", q: "ÙˆØ¶Ø¹ 'Ø§Ù„ÙØ§Ø±Ø³Ø©' (Cowgirl): Ø§Ù„Ø²ÙˆØ¬ ÙŠÙ†Ø§Ù… Ø¹Ù„Ù‰ Ø¶Ù‡Ø±Ù‡ØŒ ÙˆØ§Ù„Ø²ÙˆØ¬Ø© ØªØ±ÙƒØ¨ ÙÙˆÙ‚Ù‡ ÙˆØªØªØ­ÙƒÙ… Ù‡ÙŠ ÙÙŠ Ø§Ù„Ø³Ø±Ø¹Ø© ÙˆØ§Ù„Ø¹Ù…Ù‚." }
            ],
            prizes: [
                "Ù…Ø³Ø§Ø¬ Ù„Ù„Ø±Ø¬Ù„ÙŠÙ† (Foot Massage) Ù„Ù…Ø¯Ø© 10 Ø¯Ù‚Ø§ÙŠÙ‚.",
                "ÙØ·Ø§Ø± ÙÙŠ Ø§Ù„Ø³Ø±ÙŠØ± Ø¨ÙƒØ±Ø© Ø§Ù„ØµØ¨Ø­ (Ø£Ù†Øª Ø§Ù„Ù„ÙŠ ØªØ·Ù„Ø¨Ù‡).",
                "Ø±Ù‚ØµØ© Ø®Ø§ØµØ© Ù„ÙŠÙƒ Ù„ÙˆØ­Ø¯Ùƒ (Private Dance)."
            ],
            roleplays: [
                { chars: "Ø§Ù„Ø¯ÙƒØªÙˆØ± ÙˆØ§Ù„Ù…Ø±ÙŠØ¶Ø©", wear: "Ø§Ù„Ø²ÙˆØ¬: Ù‚Ù…ÙŠØµ Ø£Ø¨ÙŠØ¶ Ø£Ùˆ Ø¨Ø§Ù„Ø·Ùˆ / Ø§Ù„Ø²ÙˆØ¬Ø©: Ù„Ø§Ù†Ø¬Ø±ÙŠ Ø¨Ø³ÙŠØ·", plot: "Ø§Ù„Ù…Ø±ÙŠØ¶Ø© Ø¨ØªØ´ØªÙƒÙŠ Ù…Ù† 'Ø³Ø®ÙˆÙ†ÙŠØ©' ÙÙŠ Ø¬Ø³Ù…Ù‡Ø§ ÙƒÙ„Ù‡ ÙˆÙ…Ø´ Ø¹Ø§Ø±ÙØ© Ø§Ù„Ø³Ø¨Ø¨. Ø§Ù„Ø¯ÙƒØªÙˆØ± Ù„Ø§Ø²Ù… ÙŠØ¹Ù…Ù„ ÙƒØ´Ù Ø´Ø§Ù…Ù„ Ø¨Ø¥ÙŠØ¯Ù‡ (Ù…Ù† ØºÙŠØ± Ø³Ù…Ø§Ø¹Ø©) Ø¹Ù„Ù‰ ÙƒÙ„ Ø­ØªØ© ÙÙŠ Ø¬Ø³Ù…Ù‡Ø§ Ø¹Ø´Ø§Ù† ÙŠØ­Ø¯Ø¯ Ù…ÙƒØ§Ù† Ø§Ù„ÙˆØ¬Ø¹ØŒ ÙˆÙŠÙƒØªØ¨Ù„Ù‡Ø§ 'Ø§Ù„Ø¯ÙˆØ§' Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ (Ø§Ù„Ù„ÙŠ Ù‡Ùˆ Ø­Ø¶Ù†Ù‡ ÙˆØ¨ÙˆØ³Ù‡)." },
                { chars: "Ø§Ù„Ø³ÙƒØ±ØªÙŠØ±Ø© ÙˆØ§Ù„Ù…Ø¯ÙŠØ±", wear: "Ø§Ù„Ø²ÙˆØ¬: Ø¨Ø¯Ù„Ø© Ø£Ùˆ Ù‚Ù…ÙŠØµ ÙˆÙƒØ±Ø§ÙØªØ© / Ø§Ù„Ø²ÙˆØ¬Ø©: Ø¬ÙŠØ¨Ø© Ù‚ØµÙŠØ±Ø© ÙˆÙ‚Ù…ÙŠØµ", plot: "Ø§Ù„Ù…Ø¯ÙŠØ± Ø·Ø§Ù„Ø¨ Ø§Ù„Ø³ÙƒØ±ØªÙŠØ±Ø© ÙÙŠ Ù…ÙƒØªØ¨Ù‡ Ø¹Ø´Ø§Ù† 'ÙŠØ¹Ø§Ù‚Ø¨Ù‡Ø§' Ù„Ø£Ù†Ù‡Ø§ Ø§ØªØ£Ø®Ø±Øª ÙˆØªØ³Ø¨Ø¨Øª ÙÙŠ Ø®Ø³Ø§Ø±Ø© ØµÙÙ‚Ø©. Ø§Ù„Ø¹Ù‚Ø§Ø¨ Ù‡ÙŠÙƒÙˆÙ† Ø¥Ù†Ù‡Ø§ ØªØ¹Ù…Ù„ Ø£ÙŠ Ø­Ø§Ø¬Ø© ÙŠØ·Ù„Ø¨Ù‡Ø§ Ù…Ù†Ù‡Ø§ Ù„Ù…Ø¯Ø© Ù†Øµ Ø³Ø§Ø¹Ø© Ø¹Ø´Ø§Ù† ÙŠØ³Ø§Ù…Ø­Ù‡Ø§ ÙˆÙ…ÙŠØ±ÙØ¯Ù‡Ø§Ø´." }
            ]
        };

        const gameInstructions = {
            game1: { title: "1. Ù‡Ø²Ø§Ø± ÙˆÙ†Ø§Ø± ğŸ˜‚", content: `<div class="instr-point"><span class="instr-icon">ğŸ¯</span><div><strong>Ø§Ù„Ù‡Ø¯Ù:</strong> ÙƒØ³Ø± Ø§Ù„Ù…Ù„Ù„ ÙˆØ§Ù„Ø±ÙˆØªÙŠÙ†ØŒ ÙˆØ§Ù„Ø¶Ø­Ùƒ Ø³ÙˆØ§ Ø¹Ø´Ø§Ù† ØªØµÙÙˆØ§ Ø°Ù‡Ù†ÙƒÙ… Ù„Ù„ÙŠ Ø¬Ø§ÙŠ.</div></div>`, action: () => startGame('stage1') },
            game2: { title: "2. Ø­Ø¨ ÙˆÙ‚Ø±Ø¨ â¤ï¸", content: `<div class="instr-point"><span class="instr-icon">ğŸ¯</span><div><strong>Ø§Ù„Ù‡Ø¯Ù:</strong> Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠØ© ÙˆØªØ¬Ø¯ÙŠØ¯ Ù…Ø´Ø§Ø¹Ø± Ø§Ù„Ø­Ø¨.</div></div>`, action: () => startGame('stage2') },
            game3: { title: "3. Ø£Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø±ÙƒØ© âš”ï¸", content: `<div class="instr-point"><span class="instr-icon">ğŸ¯</span><div><strong>Ø§Ù„Ù‡Ø¯Ù:</strong> ØªØ­Ø¯ÙŠØ¯ Ù…ÙƒØ§Ù† Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© (Ø§Ù„Ø³Ø±ÙŠØ±ØŒ Ø§Ù„ØµØ§Ù„Ø©ØŒ Ø¥Ù„Ø®) Ø¨Ø§Ù„ØªØ±Ø§Ø¶ÙŠ.</div></div>`, action: () => startEliminationGame() },
            game4: { title: "4. Ù‡Ù…Ø³ ÙˆÙ„Ù…Ø³ ğŸ”¥", content: `<div class="instr-point"><span class="instr-icon">ğŸ¯</span><div><strong>Ø§Ù„Ù‡Ø¯Ù:</strong> Ø§Ù„ØªØ³Ø®ÙŠÙ† Ø§Ù„Ø­Ø³ÙŠ (Foreplay) ÙˆØ¥Ø´Ø¹Ø§Ù„ Ø§Ù„Ø±ØºØ¨Ø©.</div></div>`, action: () => startGame('stage3') },
            game5: { title: "5. Ù†Ø§Ø± ÙˆØ¯Ù…Ø§Ø± ğŸ”", content: `<div class="instr-point"><span class="instr-icon">ğŸ¯</span><div><strong>Ø§Ù„Ù‡Ø¯Ù:</strong> Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ø£Ù‚ØµÙ‰ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ù…ØªØ¹Ø© ÙˆØªØ¬Ø±Ø¨Ø© Ø­Ø§Ø¬Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©.</div></div>`, action: () => startGame('stage4') },
            game6: { title: "6. ØªÙ…Ø«ÙŠÙ„ Ø³Ø§Ø®Ù† ğŸ­", content: `<div class="instr-point"><span class="instr-icon">ğŸ¯</span><div><strong>Ø§Ù„Ù‡Ø¯Ù:</strong> ØªÙ‚Ù…Øµ Ø´Ø®ØµÙŠØ§Øª (Roleplay) Ù„ÙƒØ³Ø± Ø§Ù„Ø±ÙˆØªÙŠÙ†.</div></div>`, action: () => startRoleplay() },
            game7: { title: "7. Ø±Ø­Ù„Ø© Ø§Ù„Ù…ØªØ¹Ø© ğŸ²", content: `<div class="instr-point"><span class="instr-icon">ğŸ¯</span><div><strong>Ø§Ù„Ù‡Ø¯Ù:</strong> Ù„Ø¹Ø¨Ø© ØªÙ†Ø§ÙØ³ÙŠØ© Ø¨ØªÙ…Ø± Ø¨Ù…Ø±Ø§Ø­Ù„ Ù…ØªØ¯Ø±Ø¬Ø© Ù…Ù† Ø§Ù„Ø¬Ø±Ø£Ø©.</div></div>`, action: () => startCatchMe() },
            game8: { title: "8. Ø¹Ø¬Ù„Ø© Ø§Ù„Ø£ÙˆØ¶Ø§Ø¹ ğŸ¡", content: `<div class="instr-point"><span class="instr-icon">ğŸ¯</span><div><strong>Ø§Ù„Ù‡Ø¯Ù:</strong> ØªØ±Ùƒ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ù„Ù„ØµØ¯ÙØ© ÙˆØ§Ù„Ø­Ø¸ Ù„ØªØ¬Ø±Ø¨Ø© Ø£ÙˆØ¶Ø§Ø¹ Ù…Ø®ØªÙ„ÙØ©.</div></div>`, action: () => startSpinGame() },
            game9: { title: "9. Ø®Ø±Ø¨Ø´ Ù‡Ø¯ÙŠØªÙƒ ğŸ", content: `<div class="instr-point"><span class="instr-icon">ğŸ¯</span><div><strong>Ø§Ù„Ù‡Ø¯Ù:</strong> Ù…ÙƒØ§ÙØ£Ø© Ù…Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© (Aftercare) ÙˆØªØ¯Ù„ÙŠÙ„ Ø§Ù„Ø´Ø±ÙŠÙƒ.</div></div>`, action: () => initScratch() }
        };

        const catchDB = [
            { type: "start", text: "Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©", icon: "ğŸ", desc: "ÙŠÙ„Ø§ Ø¨ÙŠÙ†Ø§ Ù†Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø©.. Ø§Ø±Ù…ÙŠ Ø§Ù„Ù†Ø±Ø¯!" },
            { type: "blue", text: "Ø¨ÙˆØ³Ø©", desc: "Ø¨ÙˆØ³Ø© Ø±Ù‚ÙŠÙ‚Ø© ÙˆØ³Ø±ÙŠØ¹Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´ÙØ§ÙŠÙ.", icon: "ğŸ’‹" },
            { type: "blue", text: "Ù‡Ù…Ø³Ø©", desc: "Ù‚Ø±Ø¨ Ù…Ù† ÙˆØ¯Ù†Ù‡ ÙˆÙ‚ÙˆÙ„Ù‡ 'Ø¨Ø­Ø¨Ùƒ' Ø¨ØµÙˆØª ÙˆØ§Ø·ÙŠ.", icon: "ğŸ‘‚" },
            { type: "purple", text: "Ø¹Ø¶", desc: "Ø¹Ø¶Ø© Ø®ÙÙŠÙØ© ÙˆÙ…Ø«ÙŠØ±Ø© ÙÙŠ Ø§Ù„Ø±Ù‚Ø¨Ø© Ø£Ùˆ Ø§Ù„ÙƒØªÙ.", icon: "ğŸ§›" },
            { type: "purple", text: "ØªÙ„Ø¬", desc: "Ù…Ø´ÙŠ Ù…ÙƒØ¹Ø¨ ØªÙ„Ø¬ Ø¹Ù„Ù‰ Ø±Ù‚Ø¨Ø© ÙˆØµØ¯Ø± Ø´Ø±ÙŠÙƒÙƒ.", icon: "ğŸ§Š" },
            { type: "pink", text: "69", desc: "ÙˆØ¶Ø¹ 69 (Ù…Ø¯Ø§Ø¹Ø¨Ø© ÙÙ…ÙˆÙŠØ© Ù…ØªØ¨Ø§Ø¯Ù„Ø©) Ù„Ù…Ø¯Ø© Ø¯Ù‚ÙŠÙ‚Ø©.", icon: "â™‹" },
            { type: "pink", text: "Oral", desc: "Ø¬Ù†Ø³ ÙÙ…ÙˆÙŠ Ù„Ø´Ø±ÙŠÙƒÙƒ Ù„Ø­Ø¯ Ù…Ø§ ÙŠØ·Ù„Ø¨ Ù…Ù†Ùƒ ØªÙˆÙ‚Ù.", icon: "ğŸ­" },
            { type: "red", text: "Doggy", desc: "Ø¹Ù„Ø§Ù‚Ø© Ø¨ÙˆØ¶Ø¹ Ø§Ù„Ø¯ÙˆØ¬ÙŠ (Ù…Ù† Ø§Ù„Ø®Ù„Ù) Ù„Ù…Ø¯Ø© 3 Ø¯Ù‚Ø§ÙŠÙ‚.", icon: "ğŸ•" },
            { type: "red", text: "Ø§Ø³ØªØ³Ù„Ø§Ù…", desc: "Ù†Ø§Ù… Ø¹Ù„Ù‰ Ø¶Ù‡Ø±Ùƒ ÙˆØ³Ù„Ù… Ù†ÙØ³Ùƒ Ù„Ø´Ø±ÙŠÙƒÙƒ ÙŠÙ…ØªØ¹Ùƒ.", icon: "ğŸ³ï¸" },
            { type: "finish", text: "Ø§Ù„Ù†Ù‡Ø§ÙŠØ©", desc: "Ù…Ø¨Ø±ÙˆÙƒ! Ø§Ù„ÙƒØ³Ø¨Ø§Ù† ÙŠØ£Ù…Ø± Ø§Ù„Ø®Ø³Ø±Ø§Ù† Ø¨Ø£ÙŠ Ø·Ù„Ø¨ ÙŠÙ†ÙØ°Ù‡ ÙÙˆØ±Ø§Ù‹ ğŸ”¥", icon: "ğŸ‰" }
        ];

        const placesData = [
            { id: 1, name: "Ø§Ù„Ø³Ø±ÙŠØ±", icon: "ğŸ›ï¸" }, { id: 2, name: "Ø§Ù„ÙƒÙ†Ø¨Ø©", icon: "ğŸ›‹ï¸" }, { id: 3, name: "Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¶", icon: "ğŸ§˜" },
            { id: 4, name: "Ø±Ø®Ø§Ù…Ø© Ø§Ù„Ù…Ø·Ø¨Ø®", icon: "ğŸ”ª" }, { id: 5, name: "Ø³ÙØ±Ø© Ø§Ù„Ø·Ø¹Ø§Ù…", icon: "ğŸ½ï¸" }, { id: 6, name: "ØªØ­Øª Ø§Ù„Ø¯Ø´", icon: "ğŸš¿" },
            { id: 7, name: "Ø§Ù„Ø¨Ø§Ù†ÙŠÙˆ", icon: "ğŸ›" }, { id: 8, name: "ÙÙˆÙ‚ Ø§Ù„ØºØ³Ø§Ù„Ø©", icon: "ğŸ§º" }, { id: 9, name: "Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ±Ø³ÙŠ", icon: "ğŸª‘" }
        ];

        const wheelSegments = [
            { text: "Doggy", icon: "ğŸ•", color: "#e74c3c", desc: "Ø§Ù„Ø²ÙˆØ¬Ø© ØªØ³Ù†Ø¯ Ø¹Ù„Ù‰ Ø±ÙƒØ¨Ù‡Ø§ ÙˆØ¥ÙŠØ¯ÙŠÙ‡Ø§ØŒ ÙˆØ§Ù„Ø²ÙˆØ¬ ÙŠØ£ØªÙŠ Ù…Ù† Ø§Ù„Ø®Ù„Ù." },
            { text: "Oral", icon: "ğŸ­", color: "#e67e22", desc: "Ø§Ø³ØªØ®Ø¯Ù… ÙÙ…Ùƒ ÙˆÙ„Ø³Ø§Ù†Ùƒ Ù„Ù…Ø¯Ø§Ø¹Ø¨Ø© Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø­Ø³Ø§Ø³Ø© Ù„Ø´Ø±ÙŠÙƒÙƒ." },
            { text: "Cowgirl", icon: "ğŸ¤ ", color: "#f1c40f", desc: "Ø§Ù„Ø²ÙˆØ¬ ÙŠÙ†Ø§Ù… Ø¹Ù„Ù‰ Ø¶Ù‡Ø±Ù‡ØŒ ÙˆØ§Ù„Ø²ÙˆØ¬Ø© ØªÙ‚Ø¹Ø¯ ÙÙˆÙ‚Ù‡ ÙˆØªØªØ­ÙƒÙ…." },
            { text: "Missionary", icon: "ğŸ›Œ", color: "#cddc39", desc: "Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ Ø¨Ø³ Ø¨Ø¹Ù…Ù‚ØŒ Ø§Ù„Ø²ÙˆØ¬Ø© ØªØ±ÙØ¹ Ø±Ø¬Ù„ÙŠÙ‡Ø§." },
            { text: "69", icon: "â™‹", color: "#1abc9c", desc: "ÙˆØ¶Ø¹ ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ù…ØªØ¹Ø©ØŒ Ø§Ù„Ø²ÙˆØ¬ ÙˆØ§Ù„Ø²ÙˆØ¬Ø© Ø¹ÙƒØ³ Ø¨Ø¹Ø¶." },
            { text: "Spoon", icon: "ğŸ¥„", color: "#3498db", desc: "Ù†Ø§Ù…ÙˆØ§ Ø¹Ù„Ù‰ Ø¬Ù†Ø¨ÙƒÙ… ÙÙŠ Ù†ÙØ³ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ØŒ Ø§Ù„Ø²ÙˆØ¬ ÙˆØ±Ø§ Ø§Ù„Ø²ÙˆØ¬Ø©." }
        ];

        // =======================
        // 6. Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ´ØºÙŠÙ„ (Logic)
        // =======================
        
        function initApp() {
            if (audioCtx.state === 'suspended') { audioCtx.resume(); }
            try { playSound('click'); } catch(e) {}
            const overlay = document.getElementById('welcome-overlay');
            overlay.style.opacity = '0'; 
            setTimeout(() => {
                overlay.style.display = 'none'; 
                show('dashboard', false); 
            }, 500);
        }

        function show(id, withSound = true) {
            if(withSound) try{ playSound('click'); }catch(e){}
            document.querySelectorAll('.screen').forEach(s => { 
                if(s.id !== id) {
                    s.classList.remove('active'); 
                    setTimeout(()=> { if(!s.classList.contains('active')) s.style.display='none'; }, 300); 
                }
            });
            const el = document.getElementById(id); el.style.display = 'flex'; setTimeout(()=>el.classList.add('active'), 10);
        }

        function goHome() { show('dashboard'); }
        function openGuide() { try{playSound('click');}catch(e){} document.getElementById('modal-guide').classList.add('show'); }
        function closeGuide() { try{playSound('click');}catch(e){} document.getElementById('modal-guide').classList.remove('show'); }

        function openInstructions(gameId) {
            try{playSound('click');}catch(e){}
            const data = gameInstructions[gameId];
            if(!data) return;
            document.getElementById('instr-title').innerText = data.title;
            document.getElementById('instr-body').innerHTML = data.content;
            const btn = document.getElementById('instr-start-btn');
            btn.onclick = () => {
                document.getElementById('instructions-screen').classList.remove('show');
                data.action();
            };
            document.getElementById('instructions-screen').classList.add('show');
        }

        let currentQ = [];
        let activeStage = "";

        function startGame(stg) {
            activeStage = stg;
            if (db[stg]) {
                currentQ = shuffleArray([...db[stg]]); 
            } else {
                currentQ = []; 
            }
            
            let title = "";
            if(stg=='stage1') title="1. Ù‡Ø²Ø§Ø± ÙˆÙ†Ø§Ø± ğŸ˜‚";
            if(stg=='stage2') title="2. Ø­Ø¨ ÙˆÙ‚Ø±Ø¨ â¤ï¸";
            if(stg=='stage3') title="4. Ù‡Ù…Ø³ ÙˆÙ„Ù…Ø³ ğŸ”¥";
            if(stg=='stage4') title="5. Ù†Ø§Ø± ÙˆØ¯Ù…Ø§Ø± ğŸ”";
            document.getElementById('g-header').innerText = title;
            document.getElementById('card-obj').classList.remove('flipped');
            show('gameplay');
        }

        function flip() {
            try{playSound('click');}catch(e){}
            const c = document.getElementById('card-obj');
            if(c.classList.contains('flipped')) { c.classList.remove('flipped'); setTimeout(updTxt, 300); }
            else { updTxt(); c.classList.add('flipped'); }
        }

        function updTxt() {
            if(!db[activeStage]) return;
            if(currentQ.length===0) currentQ = shuffleArray([...db[activeStage]]);
            const item = currentQ.pop();
            const textDiv = document.getElementById('q-text');
            let roleHtml = "";
            if(item.t === 'm') roleHtml = "<div style='color:#00a8ff; font-size:1rem; margin-bottom:10px;'>ğŸ‘¨ Ø¯ÙˆØ± Ø§Ù„Ø²ÙˆØ¬</div>";
            else if(item.t === 'f') roleHtml = "<div style='color:#ff007f; font-size:1rem; margin-bottom:10px;'>ğŸ‘© Ø¯ÙˆØ± Ø§Ù„Ø²ÙˆØ¬Ø©</div>";
            else roleHtml = "<div style='color:#d4af37; font-size:1rem; margin-bottom:10px;'>ğŸ‘« Ù„ÙŠÙƒÙ… Ø³ÙˆØ§</div>";
            textDiv.innerHTML = roleHtml + item.q;
        }

        function startRoleplay() { show('roleplay-area'); genRoleplay(); }
        function genRoleplay() {
            try{playSound('click');}catch(e){}
            const rp = db.roleplays[Math.floor(Math.random() * db.roleplays.length)];
            document.getElementById('rp-chars').innerText = rp.chars;
            document.getElementById('rp-wear').innerText = rp.wear;
            document.getElementById('rp-plot').innerText = rp.plot;
        }

        let cvs, ctx, drawing=false;
        function initScratch() { show('scratch-area'); setTimeout(resetScratch, 100); }
        function resetScratch() {
            cvs = document.getElementById('cvs'); ctx = cvs.getContext('2d');
            const p = cvs.parentElement; cvs.width = p.offsetWidth; cvs.height = p.offsetHeight;
            document.getElementById('prize-txt').innerText = db.prizes[Math.floor(Math.random()*db.prizes.length)];
            ctx.globalCompositeOperation='source-over'; ctx.fillStyle='#bbb'; ctx.fillRect(0,0,cvs.width,cvs.height);
            ctx.fillStyle='#fff'; ctx.font='bold 20px Cairo'; ctx.textAlign='center'; ctx.fillText("Ø§Ø®Ø±Ø¨Ø´ Ù‡Ù†Ø§", cvs.width/2, cvs.height/2+8);
            ctx.globalCompositeOperation='destination-out';
        }
        
        document.addEventListener('mousedown', (e) => { if(e.target.id === 'cvs') drawing = true; });
        document.addEventListener('touchstart', (e) => { if(e.target.id === 'cvs') drawing = true; });
        document.addEventListener('mouseup', () => drawing = false);
        document.addEventListener('touchend', () => drawing = false);
        document.addEventListener('mousemove', (e) => { if(cvs && drawing) scratch(e); });
        document.addEventListener('touchmove', (e) => { if(cvs && drawing && e.target.id === 'cvs') { e.preventDefault(); scratch(e); } }, { passive: false });

        function scratch(e) {
            const r = cvs.getBoundingClientRect();
            const x = (e.touches?e.touches[0].clientX:e.clientX)-r.left;
            const y = (e.touches?e.touches[0].clientY:e.clientY)-r.top;
            ctx.beginPath(); ctx.arc(x,y,20,0,Math.PI*2); ctx.fill();
        }

        // --- Elimination ---
        let activePlacesCount = 9; let elimTurn = 0; 
        function startEliminationGame() { show('elimination-area'); resetElimination(); }
        function resetElimination() {
            const grid = document.getElementById('places-grid'); 
            grid.innerHTML = "";
            activePlacesCount = placesData.length; 
            elimTurn = Math.floor(Math.random() * 2); 
            updateElimTurnUI();
            document.getElementById('reset-elim-btn').style.display = 'none';
            placesData.forEach(p => {
                const card = document.createElement('div'); 
                card.className = 'place-card'; 
                card.id = `p-${p.id}`;
                card.onclick = () => eliminatePlace(p.id);
                card.innerHTML = `<div class="place-icon">${p.icon}</div><div class="place-name">${p.name}</div>`;
                grid.appendChild(card);
            });
        }
        function eliminatePlace(id) {
            if (activePlacesCount <= 1) return;
            const card = document.getElementById('p-' + id);
            if (!card || card.classList.contains('eliminated')) return;
            try{playSound('click');}catch(e){}
            card.classList.add('eliminated'); 
            activePlacesCount--;
            elimTurn = (elimTurn === 0) ? 1 : 0; 
            updateElimTurnUI();
            if (activePlacesCount === 1) declareWinnerPlace();
        }
        function updateElimTurnUI() {
            const banner = document.getElementById('elim-turn');
            if (elimTurn === 0) { banner.innerText = "Ø§Ù„Ø¯ÙˆØ± Ø¹Ù„Ù‰: Ø§Ù„Ø²ÙˆØ¬ ğŸ‘¨ (Ø§Ø­Ø°Ù Ù…ÙƒØ§Ù†)"; banner.style.color = "#00bfff"; banner.style.borderColor = "#00bfff"; }
            else { banner.innerText = "Ø§Ù„Ø¯ÙˆØ± Ø¹Ù„Ù‰: Ø§Ù„Ø²ÙˆØ¬Ø© ğŸ‘© (Ø§Ø­Ø°ÙÙŠ Ù…ÙƒØ§Ù†)"; banner.style.color = "#ff007f"; banner.style.borderColor = "#ff007f"; }
        }
        function declareWinnerPlace() {
            const allCards = document.querySelectorAll('.place-card'); let winnerText = "";
            allCards.forEach(card => { if (!card.classList.contains('eliminated')) { card.classList.add('winner'); winnerText = card.querySelector('.place-name').innerText; } });
            const banner = document.getElementById('elim-turn'); banner.innerText = `ğŸ‰ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ø®ØªØ§Ø±: ${winnerText}`; banner.style.color = "#d4af37"; banner.style.borderColor = "#d4af37";
            document.getElementById('reset-elim-btn').style.display = 'block';
            try{playSound('win');}catch(e){}
            if(navigator.vibrate) navigator.vibrate([100, 50, 100]);
        }

        // --- Catch Me ---
        const catchPlayers = [ { name: "Ø§Ù„Ø²ÙˆØ¬", icon: "ğŸ‘¨", pos: 0, css: "p1-token" }, { name: "Ø§Ù„Ø²ÙˆØ¬Ø©", icon: "ğŸ‘©", pos: 0, css: "p2-token" } ];
        let cTurn = 0; let boardCreated = false;
        function startCatchMe() { show('catch-game-area'); if(!boardCreated) { createCatchBoard(); boardCreated = true; } }
        function createCatchBoard() {
            const board = document.getElementById('board'); board.innerHTML = "";
            let row = document.createElement('div'); row.className = 'row';
            for (let i = 50; i >= 0; i--) {
                const sqData = catchDB[i] || catchDB[catchDB.length-1];
                let z = ''; if(i===0||i===50) z='finish-zone'; else if(i<=12) z='blue-zone'; else if(i<=25) z='purple-zone'; else if(i<=37) z='pink-zone'; else z='red-zone';
                const sq = document.createElement('div'); sq.className = `square ${z}`; sq.id = `sq-${i}`; sq.innerHTML = i===0 ? "Start" : i;
                row.appendChild(sq);
                if((50-i+1)%5===0 || i===0) { board.appendChild(row); row = document.createElement('div'); row.className = 'row'; }
            }
            updateTokens();
        }
        function updateTokens() {
            document.querySelectorAll('.player-token').forEach(e=>e.remove());
            catchPlayers.forEach(p => {
                const sq = document.getElementById(`sq-${p.pos}`);
                if(sq) { const t = document.createElement('div'); t.className = `player-token ${p.css}`; sq.appendChild(t); }
            });
        }
        function rollCatchDice() {
            try{playSound('dice');}catch(e){} 
            const btn = document.getElementById('catch-dice'); if(btn.classList.contains('rolling')) return;
            btn.innerText = "ğŸ²"; btn.classList.add('rolling');
            setTimeout(() => {
                const r = Math.floor(Math.random()*6)+1; btn.innerText = r; btn.classList.remove('rolling');
                moveCatchPlayer(r);
            }, 600);
        }
        function moveCatchPlayer(steps) {
            const p = catchPlayers[cTurn]; let moved = 0;
            const intv = setInterval(() => {
                if(p.pos < 50) { 
                    p.pos++; updateTokens(); moved++; 
                    localStorage.setItem('hn_catch_p1', catchPlayers[0].pos);
                    localStorage.setItem('hn_catch_p2', catchPlayers[1].pos);
                }
                if(moved >= steps || p.pos >= 50) { 
                    clearInterval(intv); 
                    setTimeout(()=>showCatchChallenge(p.pos), 500); 
                }
            }, 300);
        }
        function showCatchChallenge(pos) {
            try{playSound('win');}catch(e){}
            if(pos === 0) { switchCTurn(); return; }
            const data = catchDB[pos] || catchDB[catchDB.length-1];
            const modal = document.getElementById('catch-modal'); const content = document.getElementById('catch-card-content');
            let color = 'var(--primary)'; if(data.type === 'blue') color = 'var(--blue)'; if(data.type === 'purple') color = 'var(--purple)'; if(data.type === 'pink') color = '#ff00cc'; if(data.type === 'red') color = 'var(--accent)';
            content.style.borderColor = color;
            content.innerHTML = `<div class="catch-icon">${data.icon}</div><div class="catch-title" style="color:${color}">${data.text}</div><div class="catch-desc">${data.desc}</div><button class="btn-gold" style="background:${color}; border:none;" onclick="closeCatchModal()">Ù†ÙØ°Ù†Ø§ ğŸ˜‰</button>`;
            modal.style.display = 'flex';
        }
        function closeCatchModal() {
            try{playSound('click');}catch(e){}
            document.getElementById('catch-modal').style.display = 'none';
            if(catchPlayers[cTurn].pos >= 50) { 
                alert(`Ù…Ø¨Ø±ÙˆÙƒ! ${catchPlayers[cTurn].name} ÙƒØ³Ø¨ Ø§Ù„Ù„ÙŠÙ„Ø©! ğŸ‰`); 
                catchPlayers[0].pos=0; catchPlayers[1].pos=0; 
                localStorage.removeItem('hn_catch_p1'); localStorage.removeItem('hn_catch_p2');
                localStorage.removeItem('hn_catch_turn');
                updateTokens(); cTurn=0; 
            } else { switchCTurn(); }
        }
        function switchCTurn() { 
            cTurn = (cTurn === 0) ? 1 : 0; 
            localStorage.setItem('hn_catch_turn', cTurn);
            const p = catchPlayers[cTurn]; document.getElementById('catch-player').innerText = `${p.name} ${p.icon}`; document.getElementById('catch-pos').innerText = p.pos===0?"Start":p.pos; 
        }

        // --- Spin Wheel ---
        let wheelCreated = false; let currentRotation = 0; let spinTurn = 0; 
        const spinPlayers = [ { name: "Ø§Ù„Ø²ÙˆØ¬", icon: "ğŸ‘¨" }, { name: "Ø§Ù„Ø²ÙˆØ¬Ø©", icon: "ğŸ‘©" } ];
        function startSpinGame() { show('spin-game-area'); if (!wheelCreated) { createWheelClean(); wheelCreated = true; } updateSpinUI(); }
        function updateSpinUI() { const p = spinPlayers[spinTurn]; document.getElementById('spin-player').innerText = `${p.name} ${p.icon}`; }
        function createWheelClean() {
            let gradientString = "conic-gradient("; const segmentSize = 360 / wheelSegments.length; 
            wheelSegments.forEach((seg, i) => { const startDeg = i * segmentSize; const endDeg = (i + 1) * segmentSize; gradientString += `${seg.color} ${startDeg}deg ${endDeg}deg${i < wheelSegments.length - 1 ? ',' : ''}`; });
            gradientString += ")"; document.getElementById('wheel-bg').style.background = gradientString;
            const iconContainer = document.getElementById('wheel-icons');
            wheelSegments.forEach((seg, i) => {
                const box = document.createElement('div'); box.className = 'icon-box';
                const midAngle = (i * segmentSize) + (segmentSize / 2);
                box.style.transform = `rotate(${midAngle}deg)`;
                box.innerHTML = `<div class="icon-content" style="transform: rotate(90deg);">${seg.icon}</div>`;
                iconContainer.appendChild(box);
            });
        }
        function spinWheel() {
            const bg = document.getElementById('wheel-bg'); const icons = document.getElementById('wheel-icons');
            const spinBtn = document.querySelector('#spin-game-area .btn-gold'); if(spinBtn.disabled) return;
            
            let tickInterval = setInterval(() => { try{playSound('tick');}catch(e){} }, 200); 
            
            spinBtn.disabled = true; const randomDeg = Math.floor(1800 + Math.random() * 1800); currentRotation += randomDeg;
            bg.style.transform = `rotate(${currentRotation}deg)`; icons.style.transform = `rotate(${currentRotation}deg)`;
            
            setTimeout(() => { clearInterval(tickInterval); }, 4000);

            setTimeout(() => {
                const numSegments = wheelSegments.length; const segAngle = 360 / numSegments;
                const actualDeg = currentRotation % 360; const winningAngle = (360 - actualDeg) % 360;
                const winningIndex = Math.floor(winningAngle / segAngle);
                showWheelResult(wheelSegments[winningIndex]); spinBtn.disabled = false;
            }, 4000); 
        }
        function showWheelResult(res) { 
            try{playSound('win');}catch(e){}
            const modal = document.getElementById('wheel-modal'); document.getElementById('wheel-result-icon').innerText = res.icon; document.getElementById('wheel-result-title').innerText = res.text; document.getElementById('wheel-result-desc').innerText = res.desc; modal.style.display = 'flex'; 
        }
        function closeWheelModal() { 
            try{playSound('click');}catch(e){}
            document.getElementById('wheel-modal').style.display = 'none'; spinTurn = (spinTurn === 0) ? 1 : 0; updateSpinUI(); 
        }

        // --- RESET ---
        function openConfirmModal() {
            try{playSound('click');}catch(e){}
            const modal = document.getElementById('confirm-modal');
            if(modal) {
                modal.style.display = 'flex';
                setTimeout(() => modal.classList.add('show'), 10);
            }
        }

        function closeConfirmModal() {
            try{playSound('click');}catch(e){}
            const modal = document.getElementById('confirm-modal');
            if(modal) {
                modal.classList.remove('show');
                setTimeout(() => modal.style.display = 'none', 300);
            }
        }

        function executeReset() {
            try{playSound('click');}catch(e){}
            
            catchPlayers[0].pos = 0;
            catchPlayers[1].pos = 0;
            cTurn = 0; 

            localStorage.removeItem('hn_catch_p1');
            localStorage.removeItem('hn_catch_p2');
            localStorage.removeItem('hn_catch_turn');

            updateTokens();
            document.getElementById('catch-player').innerText = `${catchPlayers[0].name} ${catchPlayers[0].icon}`;
            document.getElementById('catch-pos').innerText = "Start";

            closeConfirmModal();
            if(navigator.vibrate) navigator.vibrate(200);
        }

    </script>
</body>
</html>
